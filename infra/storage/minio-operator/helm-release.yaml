---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minio-operator
  namespace: secops
spec:
  interval: 5m
  chart:
    spec:
      chart: minio-operator
      version: 4.3.2
      sourceRef:
        kind: HelmRepository
        name: minio
        namespace: flux-system
      interval: 5m
  install:
    crds: Create
  upgrade:
    crds: CreateReplace
  values:
    operator:
      # image:
      #   repository: minio/operator
      #   tag: v4.3.2
      env:
        - name: MINIO_OPERATOR_TLS_ENABLE
          value: "off"
        - name: CLUSTER_DOMAIN
          value: "minio.home.techtales.io"
      #   - name: WATCHED_NAMESPACE
      #     value: ""
    replicaCount: 1

    console:
      # image:
      #   repository: minio/console
      #   tag: v0.10.0
      ingress:
        enabled: false
        labels: {}
        annotations: {}
        tls: []
        host: console.local
        path: /

    tenants:
      # Tenant name
      - name: minio1
        # image:
        #   repository: minio/minio
        #   tag: RELEASE.2021-10-06T23-36-31Z
        ## Customize namespace for tenant deployment
        namespace: storage
        ## Customize any private registry image pull secret.
        ## currently only one secret registry is supported
        pools:
          ## Servers specifies the number of MinIO Tenant Pods / Servers in this pool.
          ## For standalone mode, supply 1. For distributed mode, supply 4 or more.
          ## Note that the operator does not support upgrading from standalone to distributed mode.
          - servers: 1
            ## volumesPerServer specifies the number of volumes attached per MinIO Tenant Pod / Server.
            volumesPerServer: 4
            ## size specifies the capacity per volume
            size: 10Gi
            ## storageClass specifies the storage class name to be used for this pool
            storageClassName: standard
        ## Mount path where PV will be mounted inside container(s).
        mountPath: /export
        ## Sub path inside Mount path where MinIO stores data.
        subPath: /data
        # pool secrets
        secrets:
          # create a kubernetes secret object with the accessKey and secretKey as defined here.
          enabled: true
          name: minio1-secret
          accessKey: minio
          secretKey: minio123
        # pool metrics to be read by Prometheus
        metrics:
          enabled: true
          # port: 9000
